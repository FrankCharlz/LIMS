var radius = 16;
var opacity = 0.5;

var redCircle = {
    color: '#f03',
    fillColor: '#f03',
    fillOpacity: opacity,
    radius: radius
};

var greenCircle = {
    color: 'red',
    fillColor: 'red',
    fillOpacity: opacity,
    radius: radius
};


$(document).ready(function () {
    var map = L.map('map').setView([-6.8512, 39.2544], 14);

    map.options.singleClickTimeout = 200;

    var polygon = L.polygon(
        [
            [-6.8327951318749225, 39.28396046161652],
            [-6.833418310632994, 39.28410530090333],
            [-6.833354394900316, 39.2845344543457],
            [-6.832715237103614, 39.284384250640876]
        ], redCircle
    ).addTo(map);

    // for (var n = 0; n < polygons.length; n++) {
    //     L.polygon(polygons[n], redCircle).addTo(map);
    //     console.log("added : "+n);
    // }
    console.log('added polygon');

    var popup = L.popup();

    function mapClicked(e) {

        var lat = e.latlng.lat;
        var lng = e.latlng.lng;

        var latlng = lat.toString()+'/'+lng.toString();

        var content = "<h4>Latitude: "+lat+'<br>Longitude: '+lng
            +"</h4><br><a href=plots/add/"+latlng+">Add plot information to database</a>"
            +"<br><a href=plots/view/"+latlng+">View plot information</a>";

        popup
            .setLatLng(e.latlng)
            .setContent(content)
            .openOn(map);
    }

    map.on('singleclick', mapClicked);

    L.tileLayer(
        'http://{s}.tile.osm.org/{z}/{x}/{y}.png',
        {
            attribution: '&copy;<a href="http://osm.org/copyright">OpenStreetMap</a>',
            opacity: 0.5,
            maxZoom: 20,
            maxNativeZoom: 18 //to zoom beyond native
        }
        ).addTo(map);

    /* end of map codes */
    $('#btn-show-plots').click(function () {

        $.get( "/plots/all", function(data) {
            console.log('got plots:'+ data.length);
            var popup = L.popup(); //init popup

            for (var i = 0; i<data.length; i++) {

                var boundaries = data[i]['boundaries'];

                //console.log(data[i].latitude+ " : " + data[i].longitude);
                //console.log(boundaries);

                boundaries = JSON.parse(boundaries);
                console.log(boundaries);

                var plot = L.polygon(boundaries, redCircle).addTo(map);


                popup.setContent('<h4>Plot '+data[i].plot_number+'</h4><br>'
                    +"<br><a href=plots/view/"+data[i].plot_id+">View plot information</a>"
                );

                plot.bindPopup(popup);

                if (i == 50) break;
            }
        });

    });


});

var shoelace = function (points) {
    //points is n array of coordinates as [[x1,y1],[x2,y2],...]
    var wrap = points[0];
    points.push(wrap);

    //console.log(points);

    var area = 0;
    for (var i = 0; i < points.length - 1; i++) {
        area += (points[i][0] * points[i+1][1]);
    }

    for (i = 0; i < points.length - 1; i++) {
        area -= (points[i][1] * points[i+1][0]);
    }

    return Math.abs(area/2);
};


var aaa =  [
    [1,1],
    [1,4],
    [5,4],
    [5,1]

];

//console.log("area = "+shoelace(aaa));


var polygons = [[[-6.832375936956543, 39.28199172019959], [-6.832375936956543, 39.282237620199595], [-6.832239036956543, 39.282237620199595], [-6.832239036956543, 39.28199172019959]], [[-6.832375936956543, 39.282237620199595], [-6.832375936956543, 39.2824835201996], [-6.832239036956543, 39.2824835201996], [-6.832239036956543, 39.282237620199595]], [[-6.832375936956543, 39.2824835201996], [-6.832375936956543, 39.2827294201996], [-6.832239036956543, 39.2827294201996], [-6.832239036956543, 39.2824835201996]], [[-6.832375936956543, 39.2827294201996], [-6.832375936956543, 39.282975320199604], [-6.832239036956543, 39.282975320199604], [-6.832239036956543, 39.2827294201996]], [[-6.832375936956543, 39.282975320199604], [-6.832375936956543, 39.28322122019961], [-6.832239036956543, 39.28322122019961], [-6.832239036956543, 39.282975320199604]], [[-6.832375936956543, 39.28322122019961], [-6.832375936956543, 39.28346712019961], [-6.832239036956543, 39.28346712019961], [-6.832239036956543, 39.28322122019961]], [[-6.832375936956543, 39.28346712019961], [-6.832375936956543, 39.28371302019961], [-6.832239036956543, 39.28371302019961], [-6.832239036956543, 39.28346712019961]], [[-6.832375936956543, 39.28371302019961], [-6.832375936956543, 39.283958920199616], [-6.832239036956543, 39.283958920199616], [-6.832239036956543, 39.28371302019961]], [[-6.832239036956543, 39.28199172019959], [-6.832239036956543, 39.282237620199595], [-6.832102136956543, 39.282237620199595], [-6.832102136956543, 39.28199172019959]], [[-6.832239036956543, 39.282237620199595], [-6.832239036956543, 39.2824835201996], [-6.832102136956543, 39.2824835201996], [-6.832102136956543, 39.282237620199595]], [[-6.832239036956543, 39.2824835201996], [-6.832239036956543, 39.2827294201996], [-6.832102136956543, 39.2827294201996], [-6.832102136956543, 39.2824835201996]], [[-6.832239036956543, 39.2827294201996], [-6.832239036956543, 39.282975320199604], [-6.832102136956543, 39.282975320199604], [-6.832102136956543, 39.2827294201996]], [[-6.832239036956543, 39.282975320199604], [-6.832239036956543, 39.28322122019961], [-6.832102136956543, 39.28322122019961], [-6.832102136956543, 39.282975320199604]], [[-6.832239036956543, 39.28322122019961], [-6.832239036956543, 39.28346712019961], [-6.832102136956543, 39.28346712019961], [-6.832102136956543, 39.28322122019961]], [[-6.832239036956543, 39.28346712019961], [-6.832239036956543, 39.28371302019961], [-6.832102136956543, 39.28371302019961], [-6.832102136956543, 39.28346712019961]], [[-6.832239036956543, 39.28371302019961], [-6.832239036956543, 39.283958920199616], [-6.832102136956543, 39.283958920199616], [-6.832102136956543, 39.28371302019961]], [[-6.832102136956543, 39.28199172019959], [-6.832102136956543, 39.282237620199595], [-6.831965236956543, 39.282237620199595], [-6.831965236956543, 39.28199172019959]], [[-6.832102136956543, 39.282237620199595], [-6.832102136956543, 39.2824835201996], [-6.831965236956543, 39.2824835201996], [-6.831965236956543, 39.282237620199595]], [[-6.832102136956543, 39.2824835201996], [-6.832102136956543, 39.2827294201996], [-6.831965236956543, 39.2827294201996], [-6.831965236956543, 39.2824835201996]], [[-6.832102136956543, 39.2827294201996], [-6.832102136956543, 39.282975320199604], [-6.831965236956543, 39.282975320199604], [-6.831965236956543, 39.2827294201996]], [[-6.832102136956543, 39.282975320199604], [-6.832102136956543, 39.28322122019961], [-6.831965236956543, 39.28322122019961], [-6.831965236956543, 39.282975320199604]], [[-6.832102136956543, 39.28322122019961], [-6.832102136956543, 39.28346712019961], [-6.831965236956543, 39.28346712019961], [-6.831965236956543, 39.28322122019961]], [[-6.832102136956543, 39.28346712019961], [-6.832102136956543, 39.28371302019961], [-6.831965236956543, 39.28371302019961], [-6.831965236956543, 39.28346712019961]], [[-6.832102136956543, 39.28371302019961], [-6.832102136956543, 39.283958920199616], [-6.831965236956543, 39.283958920199616], [-6.831965236956543, 39.28371302019961]], [[-6.831965236956543, 39.28199172019959], [-6.831965236956543, 39.282237620199595], [-6.8318283369565425, 39.282237620199595], [-6.8318283369565425, 39.28199172019959]], [[-6.831965236956543, 39.282237620199595], [-6.831965236956543, 39.2824835201996], [-6.8318283369565425, 39.2824835201996], [-6.8318283369565425, 39.282237620199595]], [[-6.831965236956543, 39.2824835201996], [-6.831965236956543, 39.2827294201996], [-6.8318283369565425, 39.2827294201996], [-6.8318283369565425, 39.2824835201996]], [[-6.831965236956543, 39.2827294201996], [-6.831965236956543, 39.282975320199604], [-6.8318283369565425, 39.282975320199604], [-6.8318283369565425, 39.2827294201996]], [[-6.831965236956543, 39.282975320199604], [-6.831965236956543, 39.28322122019961], [-6.8318283369565425, 39.28322122019961], [-6.8318283369565425, 39.282975320199604]], [[-6.831965236956543, 39.28322122019961], [-6.831965236956543, 39.28346712019961], [-6.8318283369565425, 39.28346712019961], [-6.8318283369565425, 39.28322122019961]], [[-6.831965236956543, 39.28346712019961], [-6.831965236956543, 39.28371302019961], [-6.8318283369565425, 39.28371302019961], [-6.8318283369565425, 39.28346712019961]], [[-6.831965236956543, 39.28371302019961], [-6.831965236956543, 39.283958920199616], [-6.8318283369565425, 39.283958920199616], [-6.8318283369565425, 39.28371302019961]]];


